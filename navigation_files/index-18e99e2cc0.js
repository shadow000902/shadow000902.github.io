F.module("mantpl:mine/amine",function(require,exports,tool){var _mineDom=$("#s_xmancard_mine_new");var Dot=require("superui:util/dot");var Suggestion=require("superui:component/suggestion");var PlaceHolder=require("superui:component/placeholder");var Draggsort=require("superui:component/draggsort");var Tips=require("superui:component/tips");var STATUS={NORMAL:"normal",EDITING:"edting",EXPENDED:"expand"};var ST_CLASS={EDITING:"edting-block"};var SETBAR_SELECTOR=".s-setbar";function Amine(){
this.reqParam={addParam:null,editParam:null,expandParam:null,refreshParam:null};this.id=null;this.blockDom=null;this.__toolDom=null;this.blockName="mine";this.Suggestion=Suggestion;this.PlaceHolder=PlaceHolder;this.Tips=Tips;this.Dot=Dot;this.Draggsort=Draggsort}Amine.prototype={constructor:Amine,init:function(){this.blockName=this.blockDom&&this.blockDom.attr("data-block");this.__toolDom=this.blockDom.find(SETBAR_SELECTOR);this.blockDom.attr("data-status",STATUS.NORMAL)
;this.contentDom=this.contentDom||this.blockDom.find(".s-mblock-content");this.hasAdd=true;this.isSimp=!!parseInt(this.blockDom.find(".s-setbar").attr("data-issimp"));this.__bindEvent();this.isBlank=+$(".mine-title-num span",this.blockDom).html()===0?true:false;this.buttonFy()},setAttr:function(param){$.extend(this,param)},trimDom:function(dirDom){if(dirDom[0]){var children=dirDom[0].childNodes;for(var i in children){if(children[i]&&children[i].nodeType===3){dirDom[0].removeChild(children[i])}}}
},__bindEvent:function(){var _ctx=this;_mineDom.delegate(".s-block-"+_ctx.blockName+" .set-btn","click",function(e){var _cmd=$(this).attr("data-cmd");_ctx[_cmd]&&_ctx[_cmd]();tool.fire("usetool",{id:"5138100001",oprateMod:_ctx.id,opType:_cmd});e.stopPropagation()}).delegate(".s-block-"+_ctx.blockName+" .toggle-btn","click",function(e){var _cmd=$(this).attr("data-cmd");_ctx[_cmd]&&_ctx[_cmd](null,true);tool.fire("usetool",{id:"5138100001",oprateMod:_ctx.id,opType:_cmd})}).delegate(SETBAR_SELECTOR
,"click",function(e){e.stopPropagation()});tool.listen("mancard:subscribe/subscribe","refresh",function(data){if(data.tabid==_ctx.id||data.param.type==_ctx.blockDom.attr("data-block")){setTimeout(function(){if(_ctx.addExShow){_ctx.exshow(null,true)}else{_ctx.refresh()}},600)}})},buttonFy:function(){var _ctx=this;if(_ctx.isBlank){_ctx.__toolDom.hide()}else{_ctx.__toolDom.show()}},add:function(){var _ctx=this;if(_ctx.blockDom.hasClass("edting-block")){return false}var isFirst=_ctx.outAddPannel()
;var ban=false;this.addCb&&this.addCb(isFirst);if(!isFirst){return}_ctx.AddPannel.componentWrap.find(".sui-dialog-"+_ctx.blockName+"-pannel").delegate(".recom-item","mouseenter mouseleave mouseup",function(e){if(e.type==="mouseup"){if(ban){return}if($(this).hasClass("item-added")){ban=true;var curDom=this;_ctx.recomDelCb&&_ctx.recomDelCb($(this),function(){$(curDom).removeClass("item-added");_TipManager.call(_ctx,"delTips",$(curDom),{content:"取消成功！",flashHide:true});setTimeout(function(){
ban=false},800)})}else{ban=true;var curDom=this;_ctx.recomAddCb&&_ctx.recomAddCb($(curDom),function(){$(curDom).addClass("item-added");_TipManager.call(_ctx,"addTips",$(curDom),{flashHide:true})},function(){setTimeout(function(){ban=false},800)})}}else if(e.type==="mouseenter"){if($(this).hasClass("item-added")){_TipManager.call(_ctx,"hoverTips",$(this),{content:"已添加，点击取消",flashHide:false,icons:""})}else{if($.isIE===6){$(this).addClass("recom-hover")}}}else if(e.type==="mouseleave"){if($(this
).hasClass("item-added")){_ctx.hoverTips&&_ctx.hoverTips.hide()}else{if($.isIE===6){$(this).removeClass("recom-hover")}}}})},totop:function(){var _ctx=this;var topid="";if(_ctx.blockDom.is(".s-code-blocks:first")){return}_mineDom.find(".s-mine-wrapper").prepend(_ctx.blockDom);$(".set-totop").css("display","inline-block");$("#s_xmancard_mine_new .s-mine-wrapper .s-code-blocks:first-child").find(".set-totop").css("display","none");var topids=[];$(".s-code-blocks:visible",_mineDom).each(function(){
topids.push($(this).attr("data-block"))});tool.fire("totop",{id:_ctx.id});_setSt(_ctx.id,{cmd:"totop",tabid:100,topid:topids.join("_")})},outAddPannel:function(){var _ctx=this;var pannelParam=_ctx.pannelParam&&_ctx.pannelParam();if(_ctx.AddPannel){_ctx.AddPannel.show();_ctx.AddPannel.body.find(".recom-content").html('<div class="s-content-load s-opacity-white-background">'+'<img src="'+s_domain.staticUrl+'static/mancard/img/loading_new-f652dd2673.gif">'+"</div>");if(_ctx.hasPannelBody){
_loadRecom(_ctx.recomBlock,function(response){_ctx.AddPannel.body.find(".recom-content").html(_recomsTpl(response.data,pannelParam.itemTpl))})}return false}F.use("superui:component/dialog",function(Dialog){_ctx.AddPannel=new Dialog({identity:"changeDir",content:typeof pannelParam.content=="undefined"?_addPannelTpl(pannelParam):pannelParam.content,hasClose:true,theme:_ctx.blockName+"-pannel sui-dialog-mine-pannel",autoShow:true,height:pannelParam.height,width:841,top:pannelParam.top||308,
title:pannelParam.title});if($.isIE===6){$("#sui-dialog-mask").height($(document.body).height())}$(".sui-dialog-close").addClass("c-icon").html("&#xe610;")});if(_ctx.hasPannelBody){_loadRecom(_ctx.recomBlock,function(response){_ctx.AddPannel.body.find(".recom-content").html(_recomsTpl(response.data,pannelParam.itemTpl))})}return true},edit:function(){var _ctx=this;_ctx.blockDom.attr("data-status",STATUS.EDITING).addClass(ST_CLASS.EDITING);_ctx.__toolDom.hide();if(!_ctx.editDom){_ctx.editDom=$(
".edit-tool",_ctx.blockDom)}_ctx.editDom.show();_ctx.editCb&&_ctx.editCb();$("#s_mancard_main .s-more-bar").trigger("click")},unedit:function(){var _ctx=this;_ctx.blockDom.attr("data-status",STATUS.NORMAL).removeClass(ST_CLASS.EDITING);_ctx.__toolDom.show();_ctx.editDom.hide();_ctx.unEditCb&&_ctx.unEditCb();_ctx.buttonFy()},unexpand:function(cb){var _ctx=this;_ctx.isSimp=true;_ctx.unexshow(cb,false);_setSt(_ctx.id,{cmd:"setSimp",isSimp:"1",tabid:_ctx.id});_ctx.reqParam=$.extend({},_ctx.reqParam)
;_ctx.reqParam.refreshParam=_ctx.reqParam.refreshParam||{};_ctx.reqParam.refreshParam.isSimp=1},expand:function(cb,editing){var _ctx=this;_ctx.isSimp=false;_setSt(_ctx.id,{cmd:"setSimp",isSimp:"0",tabid:_ctx.id});_ctx.exshow(cb,false);_ctx.reqParam=$.extend({},_ctx.reqParam);_ctx.reqParam.refreshParam=_ctx.reqParam.refreshParam||{};_ctx.reqParam.refreshParam.isSimp=0},unexshow:function(cb,call){this.blockDom.removeClass("s-mblock-up").addClass("s-mblock-up");cb&&cb()},exshow:function(cb,call){
this.blockDom.removeClass("s-mblock-up");cb&&cb()},refresh:function(cb){var _ctx=this;_ctx.loading(true);_loadBlock(_ctx.id,function(data){_ctx.loading(false);if(cb){cb.call(_ctx,data)}else{_ctx.refreshCb&&_ctx.refreshCb.call(_ctx,data)}},_ctx.reqParam&&_ctx.reqParam.refreshParam)},sortFy:function(param,cb){var _ctx=this;var defaultParam={componentWrap:$(".s-mblock-content",_ctx.topDom),dragHandle:".h",delAble:true,containment:$(".s-mblock-content",_ctx.blockDom),placeholder:false,
preventShake:true};$.extend(defaultParam,param);var draggsort=new Draggsort(defaultParam);return this.draggsort=draggsort},loading:function(show){var _ctx=this;if(show){_ctx.blockDom.addClass("virtual");if(!_ctx.loadingDom){_ctx.loadingDom=$('<div class="block-loading"></div>');_ctx.blockDom.append(_ctx.loadingDom)}_ctx.loadingDom.show()}else{_ctx.blockDom.removeClass("virtual");_ctx.loadingDom.hide()}}};function _TipManager(tipType,$target,param){var _ctx=this;if(!_ctx[tipType]){
_ctx[tipType]=new Tips(F.mix({target:$target,identity:tipType+"manage",content:param.content||"添加成功",arrowUp:false,icons:"success",arrowLeft:"center",align:"left",autoShow:true},param))}else{if(param.flashHide){clearTimeout(_ctx.hideTout)}_ctx[tipType].hide();_ctx[tipType].target=$target;_ctx[tipType].show()}if(param.flashHide){_ctx.hideTout=setTimeout(function(){_ctx[tipType].hide()},1e3)}}function _addPannelTpl(pannelParam){
var tpl=""+'<div class="pannel-content">'+'<div class="sug-content">'+"#{sugTpl}"+"</div>"+'<div class="recom-content">'+'<div class="s-content-load s-opacity-white-background">'+'<img src="#{staticUrl}static/mancard/img/loading_new-f652dd2673.gif">'+"</div>"+"</div>"+"</div>";return $.formatString(tpl,{staticUrl:window.s_domain.staticUrl,sugTpl:pannelParam.sugTpl})}function _recomsTpl(data,itemTpl){
var tpl=""+"{{~it.dirs :oneDir:index}}"+'<div class="one-class">'+'<div class="class-title">{{=oneDir.dirName}}</div>'+'<div class="class-recoms">'+"{{~oneDir.items :item:i}}"+"#{itemTpl}"+"{{~}}"+"</div>"+"</div>"+"{{~}}";return Dot.compile($.formatString(tpl,{itemTpl:itemTpl}))({dirs:data})}function _loadRecom(block,cb){var url=block==="nplus"?"/home/"+block+"/data/manrecom":"/home/subscribe/data/manrecom"+block;$.ajaxget(url,function(data){cb&&cb(data)})}function _loadBlock(id,cb,param){
var paraStr="";paraStr=param&&"&"+$.param(param)||"";$.ajaxget("/home/subscribe/data/mancardmine?id="+id+paraStr,function(data){cb&&cb(data)})}function _setSt(id,param,cb){$.ajaxpost("/home/subscribe/submit/manoperation",param||{},function(data){cb&&cb()})}return Amine});F.addLog("mantpl:mine",{usetool:"1100001001"});
F.module("mantpl:mine/cards_manager",function(require,exports,tool){var smDot=require("superui:util/smDot");var Dialog=require("superui:component/dialog");var Draggselect=require("superui:component/draggselect");var DotCardCompile=smDot.template(['<div class="s-minesetting" id="s_mine_manager" data-id="99">','<div class="s-minesetting-wrap clearfix">','<div class="s-minesetting-left">',"<h3>已关注</h3>",'<div class="s-minesetting-content">',"<&foreach $it.tplOnSet as $selected&>",
"<&if $selected.id&>",'<div class="s-mod-item <& if $selected.id == "100"&>s_mod_myitem<&/if&>"<& if $selected.id == "100"&> canceldrag="2"<&/if&> id="s_mineitem_<&$selected.id&>" data-id="<&$selected.id&>" data-imgname="<&$selected.imgname&>" data-name="<&$selected.name&>">','<div class="c-icon s-mod-icon s-mod-icon-add">',"&#xe60b;","</div>",'<div class="c-icon s-mod-icon s-mod-icon-del">',"&#xe614;","</div>",'<div class="s-mod-title" <&if $selected.id == "100"&>canceldrag="2"<&/if&>>',
"<&$selected.name&>","</div>","</div>","<&/if&>","<&/foreach&>","</div>",'<div class="nomore-tips-left">拖动到这里可以继续关注</div>',"</div>",'<div class="s-minesetting-right">',"<h3>未关注</h3>",'<div class="s-minesetting-content">',"<&foreach $it.tplOffSet as $unselected&>","<&if $unselected.id&>",'<div class="s-mod-item" id="s_mineitem_<&$unselected.id&>" data-id="<&$unselected.id&>" data-imgname="<&$unselected.imgname&>" data-name="<&$unselected.name&>">','<div class="c-icon s-mod-icon s-mod-icon-add">',
"&#xe60b;","</div>",'<div class="c-icon s-mod-icon s-mod-icon-del">',"&#xe614;","</div>",'<div class="s-mod-title">',"<&$unselected.name&>","</div>","</div>","<&/if&>","<&/foreach&>","</div>",'<div class="nomore-tips-right">拖动到这里可以取消关注</div>',"</div>","</div>","</div>"].join(""),{varname:"it"});var LEFTCLASS_QUERY=".s-minesetting-left .s-minesetting-content";var RIGHTCLASS_QUERY=".s-minesetting-right .s-minesetting-content";var ITEM_CLASS="s-mod-item";var ITEM_CLASS_QUERY="."+ITEM_CLASS
;var DEVIAT=31;var WINDOW_HEIGHT=144;function Manager(){this.manageTpl="";this.topDom=$("#s_xmancard_mine_new");this.initManager=false}Manager.prototype={constructor:Manager,init:function(mainData,enterBtn,hideCb,$topDom){this.mainData=mainData;this.enterBtn=enterBtn;this.hideCb=hideCb;this.$topDom=$topDom;this.initManager=true},renderView:function(){var self=this;self.dialog=new Dialog({identity:"minesetting",height:112,width:512,content:DotCardCompile(this.mainData),position:function(){return{
top:"50%",left:"50%"}},theme:"minesetting sui-dialog-mine-pannel",autoShow:true,hasMask:true,hasClose:true,hackToTop:false});$(".sui-dialog-close").addClass("c-icon").html("&#xe610;");self.dialog.on("onHide",function(){self.showed=false;self.enterBtn.removeClass("edting-btn-text");self.hideCb&&self.hideCb()});self.bindEvent()},bindEvent:function(){this.dialog.body.on("mouseenter mouseleave",".s-mod-item",function(e){if(e.type==="mouseenter"){$(this).removeClass("mod-hover").addClass("mod-hover")
}else{$(this).removeClass("mod-hover")}});this.sortFy()},sortFy:function(){var self=this;var dialog=self.dialog;var _dragItem;self.draggselect=new Draggselect({identity:"minesetting",containment:dialog.body,selected:dialog.body.find(LEFTCLASS_QUERY),unselected:dialog.body.find(RIGHTCLASS_QUERY),dragsort:ITEM_CLASS_QUERY,cansort:false});self.judgeEmpty();self.draggselect.on("onBeforeSelectSwap",function(){self.draggselect.selected.parentoffset=$(".s-minesetting-left .s-minesetting-content"
).offset();self.draggselect.unselected.parentoffset=$(".s-minesetting-right .s-minesetting-content").offset();$(".nomore-tips-left",dialog.body).hide();$(".nomore-tips-right",dialog.body).hide()}).on("onSelectSwap",function(data){data.dragItem&&data.dragItem.removeClass("mod-hover");self.judgeEmpty()}).on("onBeforeSelect",function(data){_dragItem=data.dragItem;_dragItem.css("zoom","0")}).on("onAfterSelect",function(data){setTimeout(function(){_dragItem.css("zoom","1")},50)})},
judgeEmpty:function(){var self=this;var dialog=self.dialog;if(self.draggselect.selected.cache.length===0){$(".nomore-tips-left",dialog.body).show()}else{$(".nomore-tips-left",dialog.body).hide()}if(self.draggselect.unselected.cache.length===0){$(".nomore-tips-right",dialog.body).show()}else{$(".nomore-tips-right",dialog.body).hide()}},toggle:function(){var self=this;if(!self.showed){self.show()}else{self.hide()}},show:function(){var self=this;self.dialog.show();if(self.shouldReflow){self.reflow(
)}self.showed=true;self.enterBtn.removeClass("edting-btn-text").addClass("edting-btn-text")},hide:function(){var self=this;self.dialog.hide();self.showed=false;self.enterBtn.removeClass("edting-btn-text")},destroy:function(){var self=this;if(self.initManager){self.showed=false;self.initManager=false;self.dialog.window.remove();self.dialog=null;return true}return false},reflow:function(){var self=this;self.shouldReflow=true;self.draggselect.selected.collapse();self.draggselect.selected.sort(false
,true)}};return new Manager});
(function(){var scripts=document.getElementsByTagName("script"),length=scripts.length,src=scripts[length-1].src,pos=src.indexOf("/js/"),scriptPath=src.substr(0,pos)+"/js/";window.importScriptList={};window.importScript=function(filename){if(!filename)return;if(filename.indexOf("http://")==-1&&filename.indexOf("https://")==-1){if(filename.substr(0,1)=="/")filename=filename.substr(1);filename=scriptPath+filename}if(filename in importScriptList)return;importScriptList[filename]=true;document.write(
'<script src="'+filename+'" type="text/javascript"></'+"script>")}})();
F.module("mantpl:mine/model",function(require,exports,tool){var _tplData=$.parseJSON($.trim($("#s_minetpl_textarea").html()));var TAB_ID=100;var revId={};function Dao(){}var _setter={sort:function(cb,param){var idsOff=[];for(var i=0,len=_tplData.tplOffSet.length;i<len;i++){idsOff[i]=_tplData.tplOffSet[i].id}$.ajaxpost("/home/subscribe/submit/manoperation",{cmd:"seq_in",idsOn:param.ids.join("_"),idsOff:idsOff.join("_"),tabid:TAB_ID},function(data){cb&&cb(data)});for(var i=0,
len=param.ids.length;i<len;i++){revId[param.ids[i]]=i}_tplData.tplOnSet.sort(function(pre,afr){return revId[pre.id]-revId[afr.id]})},top:function(cb,param){var i=_tplData.tplOnSet.length;while(i--){if(+_tplData.tplOnSet[i].id===+param.id){var outElem=_tplData.tplOnSet.splice(i,1);_tplData.tplOnSet.unshift(outElem[0]);break}}}};var _getter={tplData:function(cb,param){cb&&cb(_tplData);return _tplData},mineHtml:function(cb,param){$.ajaxget("/home/subscribe/data/mancardmine?id="+param.id,function(
data){cb&&cb(data)})}};var _adder={card:function(cb,param){var len=_tplData.tplOffSet.length;var idsOn=[];var idsOff=[];var cardId=param.id;while(len--){if(_tplData.tplOffSet[len].id===cardId){_tplData.tplOnSet.push(_tplData.tplOffSet[len]);_tplData.tplOffSet.splice(len,1)}else{idsOff.unshift(_tplData.tplOffSet[len].id)}}len=_tplData.tplOnSet.length;while(len--){idsOn.unshift(_tplData.tplOnSet[len].id)}var result={idsOn:idsOn,idsOff:idsOff};$.ajaxpost("/home/subscribe/submit/manoperation",{
cmd:"add",idsOn:idsOn.join("_"),idsOff:idsOff.join("_"),id:cardId,tabid:TAB_ID},function(data){cb&&cb(data)});return result}};var _deler={card:function(cb,param){var len=_tplData.tplOnSet.length;var idsOn=[];var idsOff=[];var cardId=param.id;while(len--){if(_tplData.tplOnSet[len].id===cardId){_tplData.tplOffSet.push(_tplData.tplOnSet[len]);_tplData.tplOnSet.splice(len,1)}else{idsOn.unshift(_tplData.tplOnSet[len].id)}}len=_tplData.tplOffSet.length;while(len--){idsOff.unshift(
_tplData.tplOffSet[len].id)}$.ajaxpost("/home/subscribe/submit/manoperation",{cmd:"del",idsOn:idsOn.join("_"),idsOff:idsOff.join("_"),id:cardId,tabid:TAB_ID},function(data){cb&&cb(data)})}};Dao.prototype={get:function(key,cb,param){return _getter[key]&&_getter[key](cb,param)||false},set:function(key,cb,param){return _setter[key]&&_setter[key](cb,param)||false},add:function(key,cb,param){return _adder[key]&&_adder[key](cb,param)||false},del:function(key,cb,param){return _deler[key]&&_deler[key](
cb,param)||false}};return new Dao});
F.addLog("mantpl:mine/view",{manageOpt:"1100001002"});F.module("mantpl:mine/view",function(require,exports,tool){var smDot=require("superui:util/smDot");var RECOM_TPL=""+'<div class="recom-content">'+"<&foreach $cards as $oneItem&>"+"<&if $oneItem.id&>"+'<div class="recom-item" data-id="<&$oneItem.id&>">'+'<span class="recom-icon"></span>'+'<span class="recom-text"><&$oneItem.name&></span>'+"</div>"+"<&/if&>"+"<&/foreach&>"+"</div>";var Tips=require("superui:component/tips")
;var recomTpl=smDot.template(RECOM_TPL,{varname:"cards"});function View(){this.$topDom=$("#s_xmancard_mine_new")}View.prototype={showDialog:function(setsData,addCb){var _ctx=this;if(!!_ctx.addPannel){_ctx.addPannel.body.html(recomTpl(setsData.tplOffSet));_ctx.addPannel.show();return}F.use("superui:component/dialog",function(Dialog){_ctx.addPannel=new Dialog({identity:"mineblank",content:recomTpl(setsData.tplOffSet),hasClose:true,theme:"mine-blank-pannel sui-dialog-mine-pannel",autoShow:true,
height:188,width:491,top:"50%",title:"添加关注"});if($.isIE===6){$("#sui-dialog-mask").height($("#bottom_container").offset().top+$("#bottom_container").outerHeight())}$(".sui-dialog-close").addClass("c-icon").html("&#xe610;");var ban=false;_ctx.addPannel.window.on("click",".recom-item",function(e){if(ban){return}ban=true;var $curDom=$(this);var cardId=$curDom.attr("data-id");var isAdd=!$curDom.hasClass("item-added");if(isAdd){$curDom.addClass("item-added");_tipManager.call(_ctx,"addTips",$curDom,{
flashHide:true,wrap:_ctx.addPannel.window})}else{$curDom.removeClass("item-added");_tipManager.call(_ctx,"delTips",$curDom,{content:"取消成功！",flashHide:true,wrap:_ctx.addPannel.window})}setTimeout(function(){ban=false},600);addCb&&addCb(cardId,isAdd)}).on("mouseenter",".recom-item",function(e){var $curDom=$(this);if($curDom.hasClass("item-added")){_tipManager.call(_ctx,"hoverTips",$curDom,{content:"已添加，点击取消",flashHide:true,icons:"",wrap:_ctx.addPannel.window})}});_ctx.addPannel.on("onHide",
function(){tool.fire("manageOpt",{opType:"layerclose",opVal:-1})})})},addBlock:function(blockData,blockName,tplData,cardId){var _ctx=this;if(_ctx.$topDom.find(".s-all-blank")[0]){_ctx.$topDom.find(".s-all-blank").hide()}var _block=null;if(!(_block=_ctx.$topDom.find(".s-block-"+blockName))[0]&&blockData){var i=tplData.tplOnSet.length;var pass=false;while(i--){var curDom=null;if(pass&&(curDom=$(".s-block-"+tplData.tplOnSet[i].ename,_ctx.$topDom))[0]){break}if(tplData.tplOnSet[i].id===cardId){
pass=true}}if(i===-1){_ctx.$topDom.find(".s-mine-wrapper").prepend(_blockMaker(blockData.html,blockName))}else{curDom.after(_blockMaker(blockData.html,blockName))}}else{_ctx.$topDom.find(".s-mine-wrapper").append(_block);_block.show()}if($.isIE===6){setTimeout(function(){$("#sui-dialog-mask").height($("#bottom_container").offset().top+$("#bottom_container").outerHeight())},200)}},delBlock:function(blockName,cardId){$(".s-block-"+blockName,this.$topDom).hide();if($.isIE===6){setTimeout(function(
){$("#sui-dialog-mask").height($("#bottom_container").offset().top+$("#bottom_container").outerHeight())},200)}}};function _blockMaker(contentHTML,blockName){return""+'<div class="s-code-blocks s-block-'+blockName+'" data-block="'+blockName+'" data-status="normal">'+'<div class="s-block-container">'+contentHTML+"</div>"+"</div>"}function _tipManager(tipType,$target,param){var _ctx=this;if(!_ctx.hideTout){_ctx.hideTout={}}if(!_ctx[tipType]){_ctx[tipType]=new Tips(F.mix({target:$target,
identity:tipType+"manage",content:param.content||"添加成功",arrowUp:false,icons:"success",arrowLeft:"center",align:"center",autoShow:true,componentWrap:param.wrap},param))}else{if(param.flashHide){clearTimeout(_ctx.hideTout[tipType])}_ctx[tipType].hide();_ctx[tipType].target=$target;_ctx[tipType].show()}if(param.flashHide){_ctx.hideTout[tipType]=setTimeout(function(){_ctx[tipType].hide()},1e3)}}return new View});
F.addLog("mantpl:mine/presenter",{manageOpt:"1100001002"});F.module("mantpl:mine/presenter",function(require,exports,tool){var _mView=require("mantpl:mine/view");var Amine=require("mantpl:mine/amine");var _mModel=require("mantpl:mine/model");var cManager=require("mantpl:mine/cards_manager");var $topDom=_mView.$topDom;var _tplData=_mModel.get("tplData");var _tplSets=_tplData.tplOnSet;var _cardsMap={};var _callStack={};var _TAB_ID=100;function init(){_bindEvent();setTimeout(function(){
_activeBlock()},300);_detect();_noload()}function _noload(){$("#s_content_"+_TAB_ID).attr("data-waterpara","noload=1;")}function _detect(){if($topDom.parents(".s-content").attr("data-loaded")==="1"){_releive()}}function _activeBlock(){for(var i=0,len=_tplSets.length;i<len;i++){var tplName="mantpl:"+_tplSets[i].ename+"/mine";F.call(tplName,"init",Amine)}var mergeSet=_tplData.tplOffSet.concat(_tplData.tplOnSet);for(i=0,len=mergeSet.length;i<len;i++){_cardsMap[+mergeSet[i].id]=mergeSet[i].ename}
i=_tplData.tplOnSet.length;while(i--){_callStack[_tplData.tplOnSet[i].id]=true}}function _bindEvent(){$topDom.on("click",".tips-manager-btn",function(e){var _curDom=this;if(!cManager.initManager){cManager.init(_tplData,$(_curDom),_hideCb,$topDom);cManager.renderView();_sortActionAdd(cManager.draggselect)}cManager.toggle();tool.fire("manageOpt",{opType:cManager.showed?"manageshow":"managehide",opVal:-1});e.stopPropagation()}).on("click",".manager-notify",function(e){e.stopPropagation()}).on(
"mouseenter",function(e){if(!cManager.initManager){F.call("mantpl:mine/cards_manager","")}});tool.listen("mancard:skeleton/card","cardloaded",function(data){if(data.cardId==100){_releive()}});tool.listen("mantpl:mine/amine","totop",function(data){_mModel.set("top",null,{id:data.id});cManager.destroy()});tool.listen("mancard:subscribe/subscribe","refresh",function(data){var i=_tplData.tplOffSet.length;while(i--){if(+_tplData.tplOffSet[i].id===+data.tabid){addCard(data.tabid);cManager.destroy()}}}
)}function _blankFy(){$topDom.find(".s-mine-wrapper .s-all-blank").show();cManager.destroy()}function _hideCb(){var len=_tplData.tplOnSet.length;if(len===0){$topDom.removeClass("s-mine-blank").addClass("s-mine-blank")}for(var i=0;i<len;i++){addCard(_tplData.tplOnSet[i].id,true)}len=_tplData.tplOffSet.length;for(var i=0;i<len;i++){delCard(_tplData.tplOffSet[i].id,true)}}function _addCb(cardId,isAdd){if(isAdd){addCard(cardId);tool.fire("manageOpt",{opType:"layeradd",opVal:cardId})}else{delCard(
cardId);tool.fire("manageOpt",{opType:"layerdel",opVal:cardId})}}function addCard(cardId,noStatus){var tplName="mantpl:"+_cardsMap[cardId]+"/mine";!noStatus&&_mModel.add("card",null,{id:cardId});if(!_callStack[cardId]){_mModel.get("mineHtml",function(data){_mView.addBlock(data,_cardsMap[cardId],_tplData,cardId);F.call(tplName,"init",Amine)},{id:cardId});_callStack[cardId]=true}else{if($(".s-block-"+_cardsMap[cardId]+" .edit-tool").css("display")=="block"){$(
".s-block-"+_cardsMap[cardId]+" .edit-tool .edit-comp").trigger("click")}_mView.addBlock(null,_cardsMap[cardId],_tplData,cardId)}$topDom.removeClass("s-mine-blank")}function delCard(cardId,noStatus){!noStatus&&_mModel.del("card",null,{id:cardId});_mView.delBlock(_cardsMap[cardId],cardId);if(_tplData.tplOnSet.length===0){$topDom.removeClass("s-mine-blank").addClass("s-mine-blank").find(".s-mine-wrapper .s-all-blank").show();_blankFy()}}function _sortActionAdd(draggselect){draggselect.on(
"onSelectSwap",function(e){switch(e.type){case"added":var cardId=e.dragItem.attr("data-id");_mModel.add("card",null,{id:cardId});tool.fire("manageOpt",{opType:"manageadd",opVal:cardId});case"switch":var drags=draggselect.selected.drags;var cache=draggselect.selected.cache;var ids=[];F.each(cache,function(item){ids.push(drags.eq(item).attr("data-id"))});_mModel.set("sort",null,{ids:ids});break;case"remove":var cardId=e.dragItem.attr("data-id");_mModel.del("card",null,{id:cardId});tool.fire(
"manageOpt",{opType:"managedel",opVal:cardId});break}if(e.type==="switch"){tool.fire("manageOpt",{opType:"managesort"})}_judgeDelay()})}function _judgeDelay(){if(!cManager.showed){cManager.shouldReflow=true;_hideCb()}}function _releive(){$topDom.removeClass("s-mine-split");if($.isIE==6){$(".sui-dialog-mask-nav-pannel").height($("body").height())}}exports.init=init});F.call("mantpl:mine/presenter","init");
F.module("mantpl:nav/mine",function(require,exports,tool){var nView=require("mantpl:nav/mine_view");var Tips=require("superui:component/tips");var _navData=$.parseJSON($.trim($("#s_minenav_textarea").html()));var _delNavCount=0;var _topDom=nView.getTopDom();var navMine=null;var DraggDirs=require("superui:component/draggdirs");var Draggsort=require("superui:component/draggsort");var Dialog=require("superui:component/dialog");var PlaceHolder=require("superui:component/placeholder")
;var smDot=require("superui:util/smDot");var DRAGG_ITEM_CLASS="d-drag-item";var DIR_ITEM_CLASS="dir-item";var DIR_BLANK_CLASS="dir-blank";var SUG_TPL=nView.SUG_TPL;var DIR_TPL=nView.DIR_TPL;var EDIT_WIDTH=256;var EDIT_DIALOG_TPL=smDot.template(""+'<div class="nav-edit-name" data-id="<&$it.id&>" data-dir="<&$it.dirId&>" url="<&$it.url&>">'+'<input value="<&$it.name&>"/>'+"</div>"+'<div class="nav-edit-url">'+'<input value="<&$it.url&>"/>'+"</div>",{varname:"it"});var TAB_ID=1;function init(
baseClass){F.inherit(NavMine,baseClass);navMine=new NavMine}function NavMine(){this.constructor();this.id=TAB_ID;this.blockDom=_topDom;this.recomBlock="nplus";this.editDom=$(".edit-tool",_topDom);this.reqParam={refreshParam:{isClassify:_navData.isClassify}};if(_navData.navCount==="0"){this.isBlank=true}this.isClassify=_navData.isClassify;this.sorted=false;this.draggSort=null;this.draggClass=null;this.init();this.initEditTips();this.hasPannelBody=true;this.bindEvent();this.domTip=null
;this.allDom=$("#s_content_100")}NavMine.prototype={bindEvent:function(){var _ctx=this;_topDom.delegate(".edit-class","click",function(e){if(_ctx.isSimp==true){_ctx.expand()}if($(this).hasClass("classed")){$(this).removeClass("classed");_ctx.classFyAction()}else{$(this).addClass("classed");_ctx.unClassFyAction()}tool.fire("navOpration",{oprateMod:TAB_ID,opration:$(this).hasClass("classed")?"classed":"unclassed"})}).delegate("."+DRAGG_ITEM_CLASS,"mouseenter mouseleave",function(e){if(
e.type==="mouseenter"){$("."+DIR_ITEM_CLASS,_topDom).attr("CANCELDRAG",1)}else{if(!$(this).attr("CANCELDRAG")){$("."+DIR_ITEM_CLASS,_topDom).removeAttr("CANCELDRAG")}}}).delegate(".edit-add","click",function(e){nView.showIndir.call(_ctx,true);e.stopPropagation()}).delegate(".edit-indir","click",function(e){e.stopPropagation()}).delegate(".dir-enter","click",function(e){var endirDom=$(this).parents(".edit-indir");_ctx.addDir(endirDom.find(".tool-add-dir").val())}).delegate(".dir-cancel","click",
function(e){nView.showIndir.call(_ctx,false)}).delegate(".add-nav","click",function(e){_ctx.add()}).delegate(".border-for-item","click",function(e){if(_topDom.hasClass("edting-block")){e.preventDefault()}else if(_ctx.contentDom.hasClass("block-nav-fanli")&&!!$(this).attr("data-fanliurl")){var url=$(this).attr("data-fanliurl");window.open(url);tool.fire("mNavClick",{oprateMod:TAB_ID,opration:"navclick",url:url});e.preventDefault()}else{var url=$(this).attr("href");tool.fire("mNavClick",{
oprateMod:TAB_ID,opration:"navclick",url:url})}$(this).parents("[data-nav]").removeClass("new-added")}).delegate(".edting-dir-name","mousemove dragstart focusout",function(e){if(e.type==="dragstart"){e.preventDefault()}e.stopPropagation();if(e.type==="focusout"){_ctx.dirRename($(e.target))}}).delegate(".dir-item","mousedown",function(e){if(!$(e.target).hasClass("edting-dir-name")&&_topDom.hasClass("edting-block")){e.preventDefault()}}).delegate(".s-fanli-tag","click",function(e){var url=$(this
).attr("data-fanlimall");window.open(url);tool.fire("mNavClick",{oprateMod:TAB_ID,opration:"navclick",url:url});e.stopPropagation();e.preventDefault()}).delegate(".nav-item-edit","click",function(e){var $parent=$(this).parents(".border-for-item");var curOffset=$parent.offset();var curWidth=$parent.width();var allOffset=_ctx.allDom.offset();var name=$.trim($parent.find(".nav-text").html());var id=$(this).parents("[data-nav]").attr("data-nav");var url=$(this).parents("[data-nav]").attr("data-url")
;var dirId=$(this).parents(".dir-item").attr("data-dir")||0;_ctx.editDialog.window.find(".sui-dialog-body").html(EDIT_DIALOG_TPL({name:name,url:url,id:id,dirId:dirId}));_ctx.editDialog.show();if($.isIE==6){_ctx.editDialog.mask.height($("#s_content_100").height())}_ctx.editDialog.window.css({left:curOffset.left+EDIT_WIDTH>_ctx.editDialog.mask.width()?curOffset.left+curWidth-EDIT_WIDTH:curOffset.left,top:curOffset.top,marginLeft:0,marginTop:0})});$(".tool-add-dir").bind("keydown",function(event){
var keyCode=event.keyCode?event.keyCode:event.which?event.which:event.charCode;if(keyCode===13){event.returnValue=false;var endirDom=$(this).parents(".edit-indir");_ctx.addDir(endirDom.find(".tool-add-dir").val())}})},initEditTips:function(){var _ctx=this;this.editDialog=new Dialog({identity:"minenavtips",content:"我是内容",buttons:["确定","取消"],autoShow:false,hasClose:false,width:EDIT_WIDTH,theme:"nav-edit"});this.editDialog.on("acting-ok",function(){var _id=$(".nav-edit-name").attr("data-id")
;var _url=$.trim($(".nav-edit-url").find("input").val());_url=_url==$(".nav-edit-name").attr("url")?"":_url;$.ajaxpost("/home/subscribe/submit/manoperation",{cmd:"modify",dirId:"",id:_id,tabid:TAB_ID,name:$.trim($(".nav-edit-name").find("input").val()),url:_url},function(response){if(response.errNo==0){var data=response.data;var $curNav=$("div[data-nav="+_id+"]",_topDom);$curNav.find(".nav-text").html(data.name);$curNav.find("a").attr({title:data.name,href:data.url});$curNav.attr({
"data-nav":data.id,"data-url":data.url});$(".nav-edit-name[data-id="+_id+"]",_topDom).attr("url",data.url);$curNav.find("img").attr("src",$.url.escapeSSL(data.iconUrl));_ctx.editDialog.hide()}else{_ctx.editNavTipsCheck(_ctx.editDialog.body.find(".nav-edit-url"),checkNavRep(response));_ctx.editNavTips.show()}});if($.isIE<=10){window.event.returnValue=false}return false})},getNavData:function(){return _navData},dirRename:function($target){var dirName=$target.val();var curDir=$target.parents(
"[data-dir]").attr("data-dir");var _ctx=this;if(dirName!=""){var repeat=false;$(".dir-name .name-text",_topDom).each(function(){if($.trim($(this).html())==dirName&&$(this).parents("[data-dir]").attr("data-dir")!=curDir){repeat=true;_ctx.editDirTips(_ctx.dialog.body.find(".edting-dir-name"))}});if(!repeat){$target.parents(".dir-name").find(".name-text").html(dirName);if(_ctx.AddPannel){var dirId=$target.parents("[data-dir]").attr("data-dir");$('.nav-dirs-layer [data-dir="'+dirId+'"]',
_ctx.AddPannel.body).html(dirName)}_ctx.draggFetch({cmd:"rename_dir",dirId:curDir,dirName:dirName})}}},classFyAction:function(){var _ctx=this;_ctx.classify(false,function(){$(".edit-add",_topDom).hide()});_ctx.contentDom.addClass("block-classed");_navData.isClassify="1";nView.showIndir.call(_ctx,false)},unClassFyAction:function(){var _ctx=this;_ctx.classify(true,function(){$(".edit-add",_topDom).show()});_ctx.contentDom.removeClass("block-classed");_navData.isClassify="0";nView.showIndir.call(
_ctx,false)},refreshCb:function(data,editing){this.contentDom.unbind("mousedown mouseup click").children().remove().end().remove();this.contentDom=$(data.html).filter(".s-mblock-content");if($(".s-mblock-bot",_topDom).length){this.contentDom.insertBefore($(".s-mblock-bot",_topDom))}else{$(".s-block-container",_topDom).append(this.contentDom)}_navData=$.parseJSON($.trim($("#s_minenav_textarea").html()));_delNavCount=0;this.sorted=false;this.isBlank=!parseInt(_navData.navCount);if(
s_session.sid.indexOf("18096")>-1||s_session.sid.indexOf("18097")>-1){var regx=/mine-title-num[^\(]+\([^\d]+(\d+)/gi,regResult;regResult=regx.exec(data.html);$(".mine-title-num span",_topDom).html(regResult[1])}},editCb:function(){if(this.isSimp==true){this.expand()}$("."+DIR_ITEM_CLASS,_topDom).show();if(!this.sorted){if(_navData.isClassify==="1"){this.draggClass=_initDrag.call(this,true,this.draggFetch)}else{this.draggSort=_initDrag.call(this,false,this.draggFetch)}this.sorting=true}else{$(
"."+DRAGG_ITEM_CLASS,_topDom).removeAttr("CANCELDRAG")}if(_navData.isClassify==="1"){$("."+DIR_BLANK_CLASS,_topDom).show();this.draggClass.draggAll.collapse();this.draggClass.draggAll.sort(null,true);nView.showIndir(false)}else{nView.showIndir(false,true)}$(".dir-name",_topDom).each(function(){$(".edting-dir-name",this).val($.trim($(".name-text",this).html()))});this.editDom.show()},unEditCb:function(){$(".nav-item .border-for-item").removeClass(
"s-opacity-border4-top s-opacity-border4-bottom s-opacity-border4-left s-opacity-border4-right");$(".d-nav-item .border-for-item").removeClass("s-opacity-border4-top s-opacity-border4-bottom s-opacity-border4-left s-opacity-border4-right");var _ctx=this;$("."+DRAGG_ITEM_CLASS,_topDom).attr("CANCELDRAG","1");$("."+DIR_ITEM_CLASS,_topDom).attr("CANCELDRAG","1");if(_navData.isClassify==="1"){$("."+DIR_BLANK_CLASS,_topDom).hide();_ctx.draggClass.draggAll.collapse();_ctx.draggClass.draggAll.sort(null
,true)}if(_navData.isClassify==="1"&&$(".s-mblock-content ."+DRAGG_ITEM_CLASS,_topDom).length==0||_navData.isClassify==="0"&&$(".s-mblock-content ."+DRAGG_ITEM_CLASS,_topDom).length==1){_ctx.isBlank=true;_ctx.contentDom.addClass("block-blank");$(".s-mblock-bot",_topDom).addClass("block-blank");_ctx.refresh()}$(".edit-indir",_topDom).hide().val("");$(".edit-add",_topDom).show();_ctx.sorting=false;_ctx.editDom.hide()},classify:function(classify,cb){var _ctx=this
;_ctx.reqParam.refreshParam.isClassify=classify?1:0;_ctx.refresh(function(data){_ctx.refreshCb(data);cb&&cb();if(classify){$(".s-mblock-bot",_topDom).show();$("."+DIR_BLANK_CLASS,_topDom).hide()}else{$(".s-mblock-bot",_topDom).hide()}})},draggFetch:function(param){_execCmd.call(this,param,function(data){})},editDirTips:function(target){var _ctx=this;if(!_ctx.editTips){_ctx.editTips=new Tips({target:target,identity:"dirrepeat",content:"目录名重复",timing:2e3,arrowDown:false,arrowLeft:"center",
icons:"error",theme:"yellow",align:"center",arrowUp:false,autoShow:true})}else{_ctx.editTips.hide();_ctx.editTips.target=target;_ctx.editTips.show()}},editNavTipsCheck:function(target,result){var _ctx=this;_ctx.editNavTips=new Tips({target:target,identity:"navcheck",content:result,timing:2e3,arrowLeft:30,icons:"error",theme:"yellow",align:"left",arrowUp:false,autoShow:true})},pannelParam:function(){this.sugWidth=681;if(_navData.isClassify=="1"){this.sugWidth=531}var sugTpl=nView.cSugMaker(
_navData.isClassify);return{sugTpl:sugTpl,title:"添加网址",itemTpl:nView.pItemTpl()}},addCb:function(isFirst){var _ctx=this;if(_ctx.isSimp==true){_ctx.expand();_ctx.isSimp=false}if(!isFirst){nView.pannelSwitch(_navData.isClassify,_ctx.AddPannel,_ctx);_ctx.AddPannel.window.css({top:Math.min(100+$(window).scrollTop(),$("#s_wrap").height()+$("#head_wrapper").height()-_ctx.AddPannel.window.height())});return}_ctx.AddPannel.window.css({top:Math.min(100+$(window).scrollTop(),$("#s_wrap").height()+$(
"#head_wrapper").height()-_ctx.AddPannel.window.height())});_ctx.sugTwo=[$(".sug-name",_ctx.AddPannel.body),$(".sug-link",_ctx.AddPannel.body)];var dirSug=$(".sug-dir-input",_ctx.AddPannel.body);nView.initPlaceHolder(_ctx);nView.initSug(_ctx);this.domTip=$(".nav-sug-wrap");nView.initTips(_ctx,_ctx.domTip);_ctx.AddPannel.body.delegate(".sug-button","click",function(e){var result=-1;var error=0;var validate=_validateInput(_ctx.sugTwo[0].val(),_ctx.sugTwo[1].val());if(!validate.suc){
_ctx.sugTwo[validate.tipPos].errorTips.show();_ctx.sugTwo[validate.tipPos].val("").focus();for(var i in _ctx.sugTwo){_ctx.sugInstance[i].clearResult()}return}_ctx.add2Dir({navName:_ctx.sugTwo[0].val(),link:validate.url},dirSug,function(response){for(var i in _ctx.sugTwo){_ctx.sugTwo[i].val("").focus();_ctx.sugInstance[i].hide();_ctx.sugInstance[i].clearResult()}_ctx.domTip.successTips.show();$(".sug-dir-input").val("未选择分类").attr("data-dir","-1");nView.hideDirs($(".sug-my-dirs"),_ctx)})}
).delegate(".sug-my-dirs","click",function(e){if($(this).hasClass("showed")){nView.hideDirs($(this),_ctx)}else{nView.showDirs($(this),_ctx)}e.stopPropagation()}).delegate(".dir-item","click",function(e){dirSug.attr("data-dir",$(this).attr("data-dir"));dirSug.val($(this).html());nView.hideDirs($(".sug-my-dirs"),_ctx);$(".nav-dirs-layer",_ctx.AddPannel.body).hide();e.stopPropagation()}).on("click",function(e){nView.hideDirs($(".sug-my-dirs"),_ctx)});_ctx.AddPannel.on("onHide",function(e){return
;nView.hideDirs($(".sug-my-dirs"),_ctx);_ctx.sugTwo[0].val("");_ctx.sugTwo[1].val("");if(_ctx.addHappen){setTimeout(function(){_ctx.addHappen=false},500)}tool.fire("navOpration",{oprateMod:TAB_ID,opration:"closeWindow"})});_ctx.AddPannel.componentWrap.on("click",function(e){nView.hideDirs($(".sug-my-dirs"),_ctx)})},recomAddCb:function($target,cb,end){this.add2Dir({navName:$.trim($target.find(".recom-text").html()),link:$target.attr("data-url"),target:$target},null,cb,end)},recomDelCb:function(
$target,cb){this.delItem({navName:$.trim($target.find(".recom-text").html()),link:$target.attr("data-url"),navId:$target.attr("data-id")},cb)},add2Dir:function(sug,dirSug,cb,end){var _ctx=this;var link=sug.link;try{link=decodeURIComponent(sug.link)}catch(e){link=sug.link}var param={cmd:"add",from:"u_layer",name:sug.navName,url:link,customDirId:dirSug?dirSug.attr("data-dir")||-1:-1};_execCmd.call(this,param,function(response){end&&end();if(response.errNo=="6004"){_ctx.domTip.warnTips.show()
;return false}else if(response.errNo=="501"){_ctx.domTip.alertTips.show();return false}else if(response.errNo=="500"){_ctx.sugTwo[0].failTips.target=sug.target||_ctx.sugTwo[0];_ctx.sugTwo[0].failTips.show();return false}else if(parseInt(response.errNo)!=0){_ctx.sugTwo[0].failTips.target=sug.target||_ctx.sugTwo[0];_ctx.sugTwo[0].failTips.show();return false}if(_ctx.isBlank){_ctx.isBlank=false;$(".set-menu",_topDom).removeClass("blank-menu");_ctx.__toolDom.show();_ctx.sorted=false;setTimeout(
function(){_ctx.refresh(function(data){_ctx.contentDom.unbind("mousedown mouseup click").children().remove().end().html("").removeClass("block-blank");$(".s-mblock-bot",_topDom).removeClass("block-blank");_ctx.refreshCb.call(_ctx,data);$(".nav-item",_ctx.contentDom).addClass("new-added")})},800)}else{_ctx.addItem(response.data)}cb&&cb(response)})},addItem:function(data,blank){var _ctx=this;var itemTpl=nView.itemMaker(_navData.isClassify,data,_ctx);var dirId=data.dirId;var dirDom=null
;var dirSort=null;if(!_ctx.sorted){if(_navData.isClassify==="1"){dirDom=$('[data-dir="'+dirId+'"] .dir-content',_topDom);$('[data-dir="'+dirId+'"]',_topDom).show().removeClass(DIR_BLANK_CLASS);_ctx.trimDom(dirDom);dirDom.append(itemTpl);if(!dirDom.length){setTimeout(function(){_ctx.refresh()},800)}}else{dirDom=$(".s-mblock-content .add-nav",_topDom);_ctx.trimDom(dirDom);$(itemTpl).insertBefore(dirDom)}}else{if(_navData.isClassify==="1"){for(var i in _ctx.draggClass.draggdirs){
var dirId=_ctx.draggClass.draggdirs[i].selected.componentWrap.parents("[data-dir]").attr("data-dir");if(dirId===data.dirId){dirSort=_ctx.draggClass.draggdirs[i].selected;break}}}else{dirSort=_ctx.draggSort}var item=$(itemTpl).addClass("d-drag-item").css({position:"absolute"});if(!_ctx.sorting){item.attr("CANCELDRAG",1)}var showDom;if(_navData.isClassify==="0"){var $add=$(".s-mblock-content .add-nav",_topDom);var value=dirSort.value($add);dirSort.remove(value);var $newadd=$add.remove()
;dirSort.append(item);dirSort.append($newadd);dirSort.sort(null,true)}else{dirSort.append(item);dirSort.sort(null,true)}if((showDom=dirSort.componentWrap.parents("[data-dir]")).hasClass(DIR_BLANK_CLASS)){showDom.removeClass(DIR_BLANK_CLASS).show();_ctx.draggClass.draggAll.collapse();$(".sui-draggsort-holder",showDom).hide()}if(_navData.isClassify==="1"){_ctx.draggClass.draggAll.collapse();_ctx.draggClass.draggAll.sort(null,true)}}},delItem:function(info,cb){var _ctx=this;var id=info.navId;if(
!_ctx.sorted){var param={cmd:"del_nav",name:info.navName,url:info.link,ids:id,customDirId:"-1"};_execCmd.call(this,param,function(response){if(_navData.isClassify=="1"){var curDir=$('[data-nav="'+id+'"]',_topDom).parents(".dir-item");if(curDir.find(".d-nav-item").length==1){curDir.addClass("dir-blank").hide()}$('[data-nav="'+id+'"]',_topDom).remove()}else{$('[data-nav="'+id+'"]',_topDom).remove()}cb&&cb();_ctx.addHappen=true})}else{$('[data-nav="'+id+'"] .del-icon',_topDom).trigger("click");if(
_navData.isClassify==="1"){$("."+DIR_BLANK_CLASS,_topDom).hide();_ctx.draggClass.draggAll.collapse();_ctx.draggClass.draggAll.sort(null,true)}cb&&cb()}},addDir:function(dirName){var param={cmd:"add_dir",dirName:dirName};var check=0;$(".dir-name .name-text",_topDom).each(function(){if($.trim($(this).html())==dirName){check=1}else if(dirName==""){check=2}});if($(".dir-item",_topDom).length>=30){check=3}if(check===1){nView.dirTips("repeatTip","该分类已存在");return false}else if(check===2){nView.dirTips(
"emptyTip","名称不能为空");return false}else if(check===3){nView.dirTips("emptyTip","添加超过上限");return false}var _ctx=this;$(".tool-add-dir",_topDom).val("");_execCmd.call(this,param,function(response){var dirId=response.data.dirId;var dirName=response.data.dirName;var dirTpl=$.formatString(DIR_TPL,{dirName:dirName,dirId:dirId});var item=$(dirTpl);var allSort=_ctx.draggClass.draggAll;allSort.append(item);allSort.sort(null,true,function(){var draggDir=_dirSortify.call(item.find(".dir-content"),
_ctx.draggClass.draggdirs,_ctx.draggClass.draggAll);draggDir.checkData();_ctx.draggClass.draggdirs.push(draggDir)});var dirItem='<div class="dir-item" data-dir="'+dirId+'">'+dirName+"</div>";$(".nav-dirs-layer").append(dirItem);_navData.dirs.push({dirId:dirId,dirName:dirName})});nView.showIndir.call(_ctx,false)},fanli:function(e){var $fanliTag=$(".fanli-class",_topDom);var _ctx=this;$fanliTag.toggleClass("classed");if($fanliTag.hasClass("classed")){_ctx.contentDom.removeClass("block-nav-fanli"
).addClass("block-nav-fanli")}else{_ctx.contentDom.removeClass("block-nav-fanli")}F.use("superman:common/user_attr",function(attr){attr.setAttr("navQuanyiTip",$fanliTag.hasClass("classed"))})}};function _execCmd(param,cb){param=F.mix(param,{tabid:1});$.ajaxpost("/home/subscribe/submit/manoperation",param,function(response){cb&&cb(response);tool.fire("navOpration",{oprateMod:TAB_ID,opration:param.cmd.replace("_","-")});if(parseInt(response.errNo)===0){if(param.cmd==="add"){var $numDom=$(
".mine-title-num span",_topDom);$numDom.html(parseInt($numDom.html())+1)}else if(param.cmd==="del_nav"){var $numDom=$(".mine-title-num span",_topDom);$numDom.html(parseInt($numDom.html())-1)}}})}function _initDrag(isClassify,cb){this.sorted=true;if(isClassify){$(".dir-item .d-nav-item",_topDom).addClass(DRAGG_ITEM_CLASS);return _draggDir.call(this,cb)}else{$(".nav-item",_topDom).addClass(DRAGG_ITEM_CLASS);return _draggNor.call(this,cb)}}function _draggNor(cb){var draggsort=new Draggsort({
componentWrap:$(".s-mblock-content",_topDom),identity:"minenav",dragsort:"."+DRAGG_ITEM_CLASS,dragHandle:".h",delAble:true,delSelector:".nav-del .del-icon",containment:$(".s-mblock-content",_topDom),placeholder:false,preventDefault:false});var queue={};var qStr="";draggsort.drags.each(function(){var sortN=$(this).attr("data-daraggsort");queue[sortN]=$(this).attr("data-nav")});var $content=$(".s-mblock-content",_topDom);draggsort.on("onAfterSort",function(data){qStr="";for(var i=0,
cache=data.cache,len=cache.length;i<len;i++){var curDom=$content.find('[data-daraggsort="'+cache[i]+'"]');if(!qStr){qStr=curDom.attr("data-nav");continue}if(curDom.attr("data-nav")){qStr+=","+curDom.attr("data-nav")}}var param={cmd:"seq_in",seqid:data.dragItem.attr("data-nav"),dirId:0,ids:qStr};cb&&cb(param)}).on("onSortDel",function(data){var ids=data.delItem.attr("data-nav");var param={cmd:"del_nav",ids:ids,dirIds:"0",isNplus:"0"};_delNavCount++;cb&&cb(param);if(s_session.sid.indexOf("18096"
)>-1||s_session.sid.indexOf("18097")>-1){tool.fire("navunsubscribe",{id:data.delItem.attr("data-nav")})}});return draggsort}function _draggDir(cb){var draggAllsort=_draggAll.call(this,cb);var draggdirs=[];$(".dir-item .dir-content",_topDom).each(function(){_dirSortify.call(this,draggdirs,draggAllsort,cb)});for(var i in draggdirs){draggdirs[i].checkData()}return{draggAll:draggAllsort,draggdirs:draggdirs}}function _dirSortify(draggdirs,draggAllsort,cb){var _dirId=$(this).parents("[data-dir]"
).attr("data-dir");var draggDir=new DraggDirs({cansort:true,identity:"minenav",dragsort:"."+DRAGG_ITEM_CLASS,dirId:_dirId,dir:$(this),delAble:true,containment:$(".s-mblock-content",_topDom),delSelector:".nav-del .del-icon",blankClass:DIR_BLANK_CLASS,preventDefault:false});draggdirs.push(draggDir);draggDir.on("onAfterSelect",function(data){var fromMap={};data.fromSort.drags.each(function(){var sortN=$(this).attr("data-daraggsort");fromMap[sortN]=$(this).attr("data-nav")});if(data.changed===true){
var toMap={};data.toSort.drags.each(function(){var sortN=$(this).attr("data-daraggsort");toMap[sortN]=$(this).attr("data-nav")});var fromIds="";var toIds="";for(var i=0,cache=data.fromSort.cache,len=cache.length;i<len;i++){if(i==0){fromIds=fromMap[cache[i]];continue}fromIds+=","+fromMap[cache[i]]}for(var i=0,cache=data.toSort.cache,len=cache.length;i<len;i++){if(i==0){toIds=toMap[cache[i]];continue}toIds+=","+toMap[cache[i]]}var param={cmd:"seq_out",fromDirId:data.fromSort.componentWrap.parents(
".dir-item").attr("data-dir"),toDirId:data.toSort.componentWrap.parents(".dir-item").attr("data-dir"),fromIds:fromIds,toIds:toIds,seqid:data.dragItem.attr("data-nav")};cb&&cb(param)}else{var fromIds="";for(var i=0,cache=data.fromSort.cache,len=cache.length;i<len;i++){if(i==0){fromIds=fromMap[cache[i]];continue}fromIds+=","+fromMap[cache[i]]}var param={cmd:"seq_in",ids:fromIds,seqid:data.dragItem.attr("data-nav"),dirId:data.fromSort.componentWrap.parents(".dir-item").attr("data-dir")};cb&&cb(
param)}}).on("onExchange",function(data){draggAllsort.sort(null,true);draggAllsort.collapse()}).on("onDel",function(data){var ids=data.dataNav;var dirIds=data.dataDir;var param={cmd:"del_nav",isNplus:"1",dirIds:dirIds,ids:ids};_delNavCount++;cb&&cb(param);data.fromSort.blankFy();draggAllsort.sort(null,true);draggAllsort.collapse()});return draggDir}function checkNavRep(response){var tipResult="";switch(parseInt(response.errNo)){case 6004:tipResult="该网址已存在";break;case 6001:
tipResult="导航已满，请删除不常用网址";break;case 6014:tipResult="分类不存在";break;default:tipResult="添加失败"}return tipResult}function _validateInput(name,url){var checkUrl=$.trim(url);var tip="";var tipPos="";var suc=true;var _match=checkUrl.match(/^(http|ftp|https):\/\//);name=$.trimAll($.trim(name));if(!_match){checkUrl="http://"+checkUrl}if(!/^(http|ftp|https):\/\/([\w-]+(:[\w-]+)?@)?[\w-]+(\.[\w-]+)+(:[\d]+)?([#\/\?][^\s<>;"\']*)?$/.test(checkUrl)){tip="请输入有效网址";tipPos=1;src="url";suc=false}else if(
checkUrl.length>1024){tip="网址超长！";tipPos=1;src="url";suc=false}else if(!name){src="name";tip="请输入名称";tipPos=0;suc=false}else if(new RegExp("<|>|'|\"|/|\\\\").test(name)){tip="导航名称不能包含 ' \" < > \\ / 等特殊字符。";tipPos=0;src="name";suc=false}else if(name.length>128){tip="名称超长！";tipPos=0;src="name";suc=false}return{suc:suc,tip:tip,tipPos:tipPos,url:checkUrl,name:name}}function _draggAll(cb){var draggsort=new Draggsort({componentWrap:$(".s-mblock-content",_topDom),identity:"minenav",
dragsort:"."+DIR_ITEM_CLASS,dragHandle:".h",placeholder:false,oneColDiff:true,delAble:true,containment:$(".s-mblock-content",_topDom),delSelector:".del-dir",saveEnergy:false,preventDefault:false});var fromMap={};draggsort.drags.each(function(){var sortN=$(this).attr("data-daraggsort");fromMap[sortN]=$(this).attr("data-dir")});draggsort.on("onAfterSort",function(data){var fromIds="";for(var i=0,cache=data.cache,len=cache.length;i<len;i++){if(i==0){fromIds=fromMap[cache[i]];continue}
fromIds+=","+fromMap[cache[i]]}var param={cmd:"seq_dir",dirIds:fromIds,dirId:data.dragItem.attr("data-dir")};cb&&cb(param)}).on("onSortDel",function(data){var param={cmd:"del_dir",dirIds:data.delItem.attr("data-dir")};$(".nav-dirs-layer").find('[data-dir="'+param.dirIds+'"]').remove();var delId=-1;for(var i=0,len=_navData.dirs.length;i<len;i++){if(_navData.dirs[i].dirId==param.dirIds){delId=i}}_navData.dirs.splice(delId,1);cb&&cb.call(navMine,param)});return draggsort}exports.init=init})
;F.addLog("mantpl:nav",{navOpration:"1100002001",mNavClick:"1100003001"});
F.module("mantpl:nav/mine_view",function(require,exports,tool){var _topDom=$("#s_xmancard_mine_new .s-block-nav");var SUG_TPL='<span class="sp_sg_name">{{=it[4]}}</span>'+'<span class="sp_sg_url">{{=it[1]}}</span>';var Tips=require("superui:component/tips");var Dot=require("superui:util/dot");var smDot=require("superui:util/smDot")
;var DIR_TPL=""+'<div class="dir-item dir-blank s-opacity-blank3" data-dir="#{dirId}" style="position:absolute;">'+'<div class="dir-border s-opacity-blank3"></div>'+'<div class="white-border"></div>'+'<div class="dir-name s-opacity-blank3">'+'<span class="name-text">#{dirName}</span>'+"</div>"+'<div class="dir-content s-opacity-blank3">'+"</div>"+"</div>";var BLANK_TPL=""+'<div class="nav-blank">'+'<div class="add-nav"></div>'+"</div>";function View(){this.SUG_TPL=SUG_TPL;this.DIR_TPL=DIR_TPL}
View.prototype={blankFy:function(){_topDom.addClass("block-blank");$(".s-mblock-content",_topDom).children().remove().end().removeAttr("style").unbind("mousedown mouseup click").removeClass("sui-componentWrap").html(BLANK_TPL)},showDirs:function($dom,_ctx){var navDirs;if((navDirs=$dom.find(".nav-dirs-layer"))[0]){navDirs.show()}else{
var tpl=""+'<div class="nav-dirs-layer">'+'<div class="dir-item" data-dir="-1">'+"未选择分类"+"</div>"+"{{~it.dirs :dir:index}}"+'<div class="dir-item" data-dir="{{=dir.dirId}}">'+"{{=dir.dirName}}"+"</div>"+"{{~}}"+"</div>";var dirsTpl=Dot.compile(tpl)({dirs:_ctx.getNavData().dirs});$dom.append(dirsTpl)}$dom.removeClass("showed").addClass("showed")},hideDirs:function($dom,_ctx){var navDirs;if((navDirs=$dom.find(".nav-dirs-layer"))[0]){navDirs.hide()}$dom.removeClass("showed")},
initPlaceHolder:function(_ctx){F.use("superui:component/placeholder",function(PlaceHolder){_ctx.nameHolder=new PlaceHolder({componentWrap:$(".sug-name-wrap",_ctx.AddPannel.body),top:1,left:29,identity:"mineAddSug",target:$(".sug-name",_ctx.AddPannel.body),holderText:"名称",height:30,lineheight:30});_ctx.netHolder=new PlaceHolder({componentWrap:$(".sug-link-wrap",_ctx.AddPannel.body),top:1,left:14,identity:"mineAddSug",target:$(".sug-link",_ctx.AddPannel.body),holderText:"网址",height:30,
lineheight:30})})},pannelSwitch:function(isClassify,pannel,_ctx){if(isClassify==1){$(".nav-sug-wrap",pannel.body).addClass("classify");_ctx.sugInstance[0].options("width",531);_ctx.sugInstance[1].options("width",531)}else{$(".nav-sug-wrap",pannel.body).removeClass("classify");_ctx.sugInstance[0].options("width",681);_ctx.sugInstance[1].options("width",681)}},initTips:function(_ctx,ctx2){ctx2.successTips=new Tips({target:ctx2,identity:"navsugsccuss",content:"添加成功!",timing:2e3,icons:"success",
align:"center",theme:"white",arrowUp:false,autoShow:false,theme:"nav-success"});ctx2.warnTips=new Tips({target:ctx2,identity:"navsugwarn",content:"您已添加过该网址！",timing:2e3,icons:"warning",theme:"white",align:"center",arrowUp:false,autoShow:false,theme:"nav-success"});ctx2.alertTips=new Tips({target:ctx2,identity:"navsugalert",content:"添加超过上限!",timing:2e3,icons:"warning",theme:"white",align:"center",arrowUp:false,autoShow:false,theme:"nav-success"});for(var i in _ctx.sugTwo){
_ctx.sugTwo[i].errorTips=new Tips({target:_ctx.sugTwo[i],identity:"navsugerror",content:"请输入有效网址",timing:2e3,arrowDown:false,icons:"error",theme:"white",align:"left",autoShow:false});_ctx.sugTwo[i].failTips=new Tips({target:_ctx.AddPannel.body.find(".sug-content"),identity:"navsugfail",content:"系统升级中，暂不支持添加此网址。小度正在尽全力恢复服务，我们对此深感抱歉！",timing:2e3,arrowDown:false,arrowLeft:"center",icons:"error",theme:"white",align:"center",arrowUp:false,autoShow:false})}},dirTips:function(tipType,content){
var _ctx=this;if(!_ctx[tipType]){_ctx[tipType]=new Tips({target:$(".tool-add-dir",_topDom),identity:"navsugsccuss",content:content,timing:2e3,model:"left",arrowDown:false,arrowLeft:"center",icons:"error",theme:"white",align:"center",autoShow:false})}_ctx[tipType].show()},initSug:function(_ctx){var sugName=_ctx.sugTwo[0];var sugLink=_ctx.sugTwo[1];_ctx.sugInstance=[];F.use("superui:component/suggestion",function(Suggestion){_ctx.sugInstance[0]=new Suggestion({componentWrap:$(".sug-content",
_ctx.AddPannel.body),identity:"navAddPannel",input:sugName,width:_ctx.sugWidth,url:"//www.baidu.com/sugrec?wd={wd}&prod=open_superpage&json=1",template:SUG_TPL,autoFill:null,focusShow:false});_ctx.sugInstance[1]=new Suggestion({componentWrap:$(".sug-content",_ctx.AddPannel.body),identity:"navAddPannel",input:sugLink,posRefer:sugName,width:_ctx.sugWidth,url:"//www.baidu.com/sugrec?wd={wd}&prod=open_superpage&json=1",template:SUG_TPL,autoFill:null,focusShow:false})});for(var i=0;i<2;i++){
_ctx.sugInstance[i].on("onSelect",function(data){sugLink.val(data[1]);sugName.val(data[4]);if($.isIE<=9){_ctx.nameHolder.hide();_ctx.netHolder.hide()}})}},showIndir:function(show,allHide){var _ctx=this;var inDir=$(".edit-indir",_topDom);var addDom=$(".edit-tool .edit-add",_topDom);if(show){if(!_ctx.IndirHolder){F.use("superui:component/placeholder",function(PlaceHolder){_ctx.IndirHolder=new PlaceHolder({componentWrap:$(".edit-indir",_topDom),top:5,left:10,identity:"mineAddDir",target:$(
".tool-add-dir",_topDom),holderText:"快速创建分类",height:22,lineheight:22})})}inDir.show();addDom.hide()}else{inDir.find(".tool-add-dir").val("");inDir.hide();addDom.show()}if(allHide){inDir.hide();addDom.hide()}},getTopDom:function(){return _topDom},cSugMaker:function(isClassify){
this.C_SUG_TPL=""+'<div class="nav-sug-wrap#{classsi}">'+'<div class="sug-name-wrap">'+'<input type="text" class="sug-name"/>'+"</div>"+'<div class="sug-link-wrap">'+'<input type="text" class="sug-link"/>'+"</div>"+'<div class="sug-my-dirs">'+'<input class="sug-dir-input" value="未选择分类" '+'data-dir="-1" readonly="readonly" disabled="disabled"/>'+'<div class="input-icon"></div>'+"</div>"+'<div class="sug-button">'+"添加网址"+"</div>"+"</div>";var classsi=isClassify=="1"?" classify":""
;return $.formatString(this.C_SUG_TPL,{classsi:classsi})},itemMaker:function(isClassify,data,_ctx){var typeClass=isClassify==="1"?"d-nav-item":"nav-item"
;var tpl=""+'<div class="c-span3 c-gap-left-large <&$oneItem.typeClass&> new-added" data-nav="<&$oneItem.id&>" data-url="<&$oneItem.url&>">'+'<a class="border-for-item" href="<&$oneItem.url&>" target="_blank">'+'<div class="nav-del">'+'<i class="c-icon del-icon">&#xe614;</i>'+"</div>"+'<span class="nav-item-edit"><i class="c-icon">&#xe612;</i></span>'+'<&if !$oneItem.iconUrl&><div class="nav-icon-normal"><&$oneItem.name|sp_escape_html|upper&></div><&else&>'+'<div class="nav-icon"><img src="<&$oneItem.iconUrl&>" height="32px" width="32px"></div><&/if&>'+'<div class="c-gap-left-small nav-text">'+'<span class="nav-text-content">'+"<&$oneItem.name|sp_escape_html&>"+"</span>"+"</div>"+"</a>"+"</div>"
;return smDot.template(tpl,{varname:"oneItem"})({typeClass:typeClass,id:data.id,iconUrl:data.iconUrl&&$.url.escapeSSL(data.iconUrl),name:data.name,url:data.url})},pItemTpl:function(){return""+'<div class="recom-item{{? item.isadd=="1"}} item-added{{?}}" data-id="{{=item.id}}" data-url="{{=item.url}}">'+'<span class="recom-icon"></span>'+'<span class="recom-text">{{=item.name}}</span>'+"</div>"},editConMaker:function(text){
return'<input type="text" value="'+text+'" class="edting-dir-name" maxlength="19"/>'}};return new View});
F.module("mantpl:stock/mine",function(require,exports,tool){var stockMine=null;var _stockData=$.parseJSON($.trim($("#s_minestock_textarea").html()));var _topDom=$("#s_xmancard_mine_new .s-block-stock");var DRAGG_ITEM_CLASS="stock-item";var TAB_ID=12;var smDot=require("superui:util/smDot");var SUG_TPL='<span class="sp-sg-code">{{=it["code"]}}</span>'+'<span class="sp-sg-name">{{=it["name"]}}</span>'+'<span class="sp-sg-market">{{=it["market"]}}</span>';var smTpl=smDot.template($(".tpl-area",
_topDom).text(),{varname:"oneStock"});smDot.template("",{varname:"it"});function init(baseClass){F.inherit(StockMine,baseClass);stockMine=new StockMine}function StockMine(){this.constructor();this.id=TAB_ID;this.blockDom=_topDom;this.recomBlock="stock";this.editExpand=true;this.init();this.bindEvent()}StockMine.prototype={freshDom:function(stocks,contentDom){var _ctx=this;var allTpl="";var len=0;if(contentDom){_ctx.contentDom.unbind("mousedown mouseup click").children().remove()
;_ctx.contentDom.remove();_ctx.contentDom=contentDom;if($(".s-mblock-bot",_topDom).length){_ctx.contentDom.insertBefore($(".s-mblock-bot",_topDom))}else{$(".s-block-container",_topDom).append(_ctx.contentDom)}stocks=$.parseJSON($.trim($("#s_minestock_textarea",contentDom).html())).stocks;var len=stocks.length;if(len>0){_ctx.isBlank=false;_ctx.sorted=false;$(".stock-banner",_topDom).removeClass("stock-banner-hide");$(".stock-item-add",_topDom).removeClass("stock-item-blank")}else{$(
".stock-banner",_topDom).addClass("stock-banner-hide");$(".stock-item-add",_topDom).addClass("stock-item-blank")}$(".mine-title-num span",_topDom).html(len);return}for(var i in stocks){allTpl+=_itemMaker.call(_ctx,stocks[i]);len++}if(len>0){_ctx.isBlank=false;_ctx.sorted=false;_ctx.contentDom.unbind("mousedown mouseup click").children().remove().end().html(allTpl);$(".stock-banner",_topDom).removeClass("stock-banner-hide");$(".stock-item-add",_topDom).removeClass("stock-item-blank")}else{
_ctx.blankfy()}},refreshCb:function(data){if(this.isSimp===true){this.expand()}this.freshDom(null,$(data.html).filter(".s-mblock-content"))},bindEvent:function(){var _ctx=this;_topDom.delegate(".add-stock","click",function(e){_ctx.add()}).delegate(".stock-item .stock-link","click",function(e){var $item=$(this).parents(".stock-item");if($item.attr("canceldrag")=="1"||!$item.attr("data-daraggsort")){var market="";if($item.attr("data-market")==="stockus"){market+=" 美股"}else{market+=" 股票"}
var stockUrl="//www.baidu.com/s?wd="+$item.data("code")+market+"&ie=utf-8&tn=SE_baiduhomet1_zehq5d4k&rsv_idx=2";window.open(stockUrl);tool.fire("stockClick",{oprateMod:TAB_ID,opration:"stockclick",url:stockUrl})}})},editCb:function(){if(this.isSimp===true){this.expand()}if(!this.sorted){_draggNor.call(this,this.draggFetch)}else{$("."+DRAGG_ITEM_CLASS,_topDom).removeAttr("CANCELDRAG")}},unEditCb:function(){var _ctx=this;if($(".stock-item",_topDom).length===0){_ctx.isBlank=true;$(".stock-item-add"
,_topDom).addClass("stock-item-blank")}$("."+DRAGG_ITEM_CLASS,_topDom).attr("CANCELDRAG","1");if($("."+DRAGG_ITEM_CLASS,_topDom).length==0){_ctx.refresh()}},blankfy:function(){var BLANK_TPL=""+'<div class="stock-blank">'+'<div class="add-stock"></div>'+"</div>";this.isBlank=true;this.contentDom.children().remove().end().addClass("block-blank").html(BLANK_TPL);$(".stock-banner",_topDom).addClass("stock-banner-hide");$(".stock-item-add",_topDom).addClass("stock-item-blank")},draggFetch:function(
param){_execCmd.call(this,param,function(data){})},pannelParam:function(){this.sugWidth=681;var sugTpl=_cSugMaker();return{sugTpl:sugTpl,title:"添加股票",itemTpl:_pItemTpl(),content:'<div class="pannel-content"><div class="sug-content">'+sugTpl+"</div></div>",height:120,top:210}},addCb:function(isFirst){var _ctx=this;if($.isIE===6){$(".sui-dialog-stock-pannel").css({top:"+="+$(window).scrollTop()})}if(_ctx.isSimp===true){_ctx.expand()}if(!isFirst){return}_initSug.call(_ctx)
;var $linkDom=_ctx.AddPannel.componentWrap.find(".sui-dialog-stock-pannel .sug-link");_ctx.AddPannel.body.delegate(".sug-button","click",function(e){_ctx.addAction($linkDom)}).delegate(".sug-link","keydown",function(e){if(e.keyCode==8){$linkDom.removeAttr("data-code").removeAttr("data-market")}}).delegate(".sug-link","click",function(e){if(_ctx.sugInstance.cache){_ctx.sugInstance.show()}});_ctx.AddPannel.on("onhide",function(){$linkDom.val("").data("market","");_ctx.sugInstance.cache=null
;_ctx.PlaceTips.show()})},addAction:function($linkDom){var _ctx=this;if($linkDom&&$linkDom.val()!=""){if(!!$linkDom.attr("data-code")&&!!$linkDom.attr("data-market")){_ctx.recomAddCb($linkDom,function(){_ctx.SuccessTips.show();$linkDom.val("").data("market","");_topDom.find(".s-setbar .set-menu").removeClass("blank-menu");_ctx.__toolDom.show()})}else{if(_ctx.sugInstance.resdata&&_ctx.sugInstance.resdata.length>0){_ctx.recomAddCb(null,function(){_ctx.SuccessTips.show();$linkDom.val("").data(
"market","");_topDom.find(".s-setbar .set-menu").removeClass("blank-menu");_ctx.__toolDom.show()},_ctx.sugInstance.resdata[0].code,_ctx.sugInstance.resdata[0].resourcename)}else{_ctx.ErroTips.show()}}$linkDom.attr("data-code","");$linkDom.attr("data-market","");_ctx.sugInstance.cache=null}},recomAddCb:function($target,cb,code,market){var stocks=_stockData.stocks;var market=$target?$target.attr("data-market"):market;var code=$target?$target.attr("data-code"):code;var rscids="";var prefix="_"
;var i=0;var _ctx=this;var sItems=$(".stock-item",_topDom);rscids=market+":"+code;this.addStock({stockcode:code,resourcename:market,rscids:rscids},cb);return true},recomDelCb:function($target){this.delItem($target.data("code"),$target.data("market"))},addStock:function(args,cb){var _ctx=this;var param={cmd:"add",rscids:args.rscids};_execCmd.call(_ctx,param,function(response){if(param.cmd=="add"){if(response.errNo=="501"&&param.cmd=="add"){stockMine.alertTips.show();return}else if(
response.errNo=="500"&&param.cmd=="add"){stockMine.warnTips.show();return}else if(response.errNo!="0"){stockMine.failTips.show();return}}cb&&cb();_stockData.stocks=[];for(var i in response.data.items){_stockData.stocks.push(response.data.items[i])}_ctx.freshDom(response.data.items)})},delItem:function(code,market){var _ctx=this;if(!_ctx.sorted){var ids="";$(".stock-item",_topDom).each(function(){ids+=market+":"+code+"_"});$('.stock-item[data-code="'+code+'"]',_topDom).remove();ids=ids.substr(0,
ids.length-1);var param={cmd:"del",rscids:ids};_ctx.draggFetch.call(this,param)}else{$('[data-code="'+code+'"] .del-icon',_topDom).trigger("click")}}};function _initSug(){var _ctx=this;F.use("superui:component/suggestion",function(Suggestion){_ctx.sugInstance=new Suggestion({componentWrap:$(".sug-content",_ctx.AddPannel.body),identity:"stockAddPannel",input:$(".sug-link",_ctx.AddPannel.body),width:691,url:"//www.baidu.com/sugrec?wd={wd}&prod=open_finance_stock&json=1",template:SUG_TPL,
autoFill:null,focusShow:false})});F.use("superui:component/tips",function(Tips){_ctx.ErroTips=new Tips({target:$(".sug-link",_ctx.AddPannel.body),componentWrap:_ctx.AddPannel.body,identity:"navsugerror",content:"请输入有效信息",timing:2e3,model:"left",icons:"error",align:"left",arrowDown:false,theme:"white",autoShow:false});_ctx.warnTips=new Tips({target:$(".sug-link",_ctx.AddPannel.body),identity:"navsugerror",componentWrap:_ctx.AddPannel.body,content:"您已添加过该股票",timing:2e3,model:"left",
icons:"warning",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"});_ctx.SuccessTips=new Tips({target:$(".sug-link",_ctx.AddPannel.body),identity:"navsugerror",componentWrap:_ctx.AddPannel.body,content:"添加成功",timing:2e3,model:"left",arrowDown:false,icons:"success",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"});_ctx.alertTips=new Tips({target:$(".sug-link",_ctx.AddPannel.body),
identity:"navsugalert",componentWrap:_ctx.AddPannel.body,content:"添加超过上限",timing:2e3,model:"left",icons:"warning",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"});_ctx.failTips=new Tips({target:$(".sug-link",_ctx.AddPannel.body),identity:"stocksugfail",componentWrap:_ctx.AddPannel.body,content:"添加失败",timing:2e3,model:"left",icons:"error",arrowLeft:"center",align:"center",arrowUp:false,theme:"white",autoShow:false,theme:"nav-success"})});F.use(
"superui:component/placeholder",function(PlaceHolder){_ctx.PlaceTips=new PlaceHolder({componentWrap:$(".sug-link-wrap",_ctx.AddPannel.body),top:1,left:30,identity:"mineAddSug",target:$(".sug-link",_ctx.AddPannel.body),holderText:"输入股票名称/代码/拼音",height:30,lineheight:30})});_ctx.sugInstance.on("onSelect",function(data){$(".sug-link",_ctx.AddPannel.body).val(data.code).attr("data-code",data.code).attr("data-market",data.resourcename)})}function _itemMaker(data){return smTpl(data)}
function _cSugMaker(){var _tpl=""+'<div class="stock-sug-wrap">'+'<div class="sug-link-wrap">'+'<input type="text" class="sug-link"/>'+"</div>"+'<div class="sug-button">'+"添加股票"+"</div>"+"</div>";return _tpl}function _pItemTpl(){return""+'<div class="recom-item{{? item.isadd=="1"}} item-added{{?}}" data-code="{{=item.code}}" data-market="{{=item.market}}">'+'<span class="recom-icon"></span>'+'<span class="recom-text">{{=item.title}}</span>'+"</div>"}function _execCmd(param,cb){var _ctx=this
;param=F.mix(param,{tabid:TAB_ID});$.ajaxpost("/home/subscribe/submit/manoperation",param,function(response){cb&&cb(response);if(parseInt(response.errNo)===0){if(param.cmd==="add"){var $numDom=$(".mine-title-num span",_topDom);$numDom.html(parseInt($numDom.html())+1)}else if(param.cmd==="del"){var $numDom=$(".mine-title-num span",_topDom);$numDom.html(parseInt($numDom.html())-1)}}tool.fire("stockOpration",{oprateMod:TAB_ID,opration:param.cmd.replace("_","-")})})}function _draggNor(cb){
var _ctx=this;var draggsort=_ctx.sortFy({identity:"minestock",dragsort:"."+DRAGG_ITEM_CLASS,delSelector:".stock-del .del-icon",dataIdenti:"data-code",componentWrap:_ctx.contentDom,containment:_ctx.contentDom});this.sorted=true;var queue={};var qStr="";this.draggsort=draggsort;this.draggsort.on("onAfterSort",function(data){qStr="";var content=_topDom.find(".s-mblock-content");var pos=0;for(var i=0,cache=data.cache,len=cache.length;i<len;i++){var curDom=content.find(
'[data-daraggsort="'+cache[i]+'"]');qStr+=curDom.attr("data-market")+":"+curDom.attr("data-code")+"_"}qStr=qStr.substr(0,qStr.length-1);var param={cmd:"seq_in",rscids:qStr,code:data.dragItem.attr("data-market")+":"+data.dragItem.attr("data-code"),pos:data.cache.indexOf(parseInt(data.dragItem.attr("data-daraggsort")))+1};cb&&cb.call(this,param)}).on("onSortDel",function(data){qStr=data.delItem.data("market")+":"+data.delItem.data("code");var param={cmd:"del",rscids:qStr}
;_stockData.delStockCount=_stockData.delStockCount?_stockData.delStockCount+1:1;cb&&cb.call(_ctx,param)})}exports.init=init});F.addLog("mantpl:stock",{stockOpration:"1100002001",stockClick:"1100003001"});